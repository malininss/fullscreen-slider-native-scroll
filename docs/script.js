"use strict";

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

var AnchorAdder = /*#__PURE__*/function () {
  function AnchorAdder() {
    _classCallCheck(this, AnchorAdder);

    if (!history.pushState) {
      return;
    }

    this.scrollHandler();
  }

  _createClass(AnchorAdder, [{
    key: "addAnchor",
    value: function addAnchor(name) {
      var baseUrl = window.location.protocol + "//" + window.location.host + window.location.pathname;
      var newUrl = baseUrl + "#".concat(name);
      history.pushState(null, null, newUrl);
    }
  }, {
    key: "scrollHandler",
    value: function scrollHandler() {
      var _this = this;

      document.addEventListener('scroll', function () {
        // Надо вынести значения в отдельный массив, чтобы не пробегать каждый раз циклом
        _this.anchorsLink.forEach(function (item) {
          var anchorTopCoord = GetCoords.getCoords(item).top;

          if (pageYOffset >= anchorTopCoord && pageYOffset <= anchorTopCoord + 500) {
            _this.addAnchor(item.name);
          }
        });
      });
    }
  }, {
    key: "anchorsLink",
    get: function get() {
      return document.querySelectorAll('a.anchor');
    }
  }]);

  return AnchorAdder;
}();

var ScreenSlider = /*#__PURE__*/function () {
  function ScreenSlider(id) {
    _classCallCheck(this, ScreenSlider);

    this.mainContainer = document.querySelector("#".concat(id));

    if (!this.mainContainer) {
      throw new Error('Id не передан в конструктор элемента ScreenSlider, либо элемент не найден на странице');
    }

    this.sections = Array.from(this.mainContainer.querySelectorAll('.full-scroll__element'));
    this.fog = this.mainContainer.querySelector('.full-scroll__fog');
    this.smoke1 = this.mainContainer.querySelector('.full-scroll__smoke_bg1');
    this.smoke2 = this.mainContainer.querySelector('.full-scroll__smoke_bg2');
    this.smoke3 = this.mainContainer.querySelector('.full-scroll__smoke_bg3');
    this.smoke1Black = this.mainContainer.querySelector('.full-scroll__smoke_bg1-black');
    this.smoke2Black = this.mainContainer.querySelector('.full-scroll__smoke_bg2-black');
    this.smoke3Black = this.mainContainer.querySelector('.full-scroll__smoke_bg3-black');
    this.activeSmoke1;
    this.activeSmoke2;
    this.activeSmoke3;
    this.colorTheme = 'white';
    this.progressBar = this.mainContainer.querySelector('.full-scroll__progress-bar');
    this.currentSection = '';
    this.scrollDirection;

    if (this.mainContainer.classList.contains('full-scroll__to-standart-scroll')) {
      this.toStandartScroll();
      return;
    }

    this.eventHendler();
    this.changeElementVisible();
  }

  _createClass(ScreenSlider, [{
    key: "calcScrollPercent",
    value: function calcScrollPercent() {
      // console.log(this.sections.indexOf(this.currentSection))
      if (this.sections.indexOf(this.currentSection) === this.sections.length - 1) {
        return Math.floor((pageYOffset - GetCoords.getCoords(this.currentSection).top) / (this.currentSection.clientHeight - window.innerHeight) * 100);
      }

      if (this.currentSection) {
        return Math.floor((pageYOffset - GetCoords.getCoords(this.currentSection).top) / this.currentSection.clientHeight * 100);
      }
    }
  }, {
    key: "changeElementVisible",
    value: function changeElementVisible() {
      var _this2 = this;

      this.sections.forEach(function (item) {
        var fixedBlock = item.querySelector('.full-scroll__fixed-wrapper');
        var elemCoords = GetCoords.getCoords(item);

        if (pageYOffset >= elemCoords.top && elemCoords.bottom >= pageYOffset) {
          _this2.currentSection = item;
          fixedBlock.classList.add('full-scroll__fix-state');
        } else {
          fixedBlock.classList.remove('full-scroll__fix-state');
        }

        if (_this2.currentSection === _this2.sections[_this2.sections.length - 1]) {
          if (pageYOffset >= GetCoords.getCoords(_this2.currentSection).bottom - window.innerHeight) {
            fixedBlock.classList.remove('full-scroll__fix-state');
            fixedBlock.classList.add('full-scroll__last-elem');
          } else {
            fixedBlock.classList.remove('full-scroll__last-elem');
          }
        }
      });
    }
  }, {
    key: "setAboveBgOpacity",
    value: function setAboveBgOpacity() {
      if (this.colorTheme === 'white') {
        this.activeSmoke1 = this.smoke1;
        this.activeSmoke2 = this.smoke2;
        this.activeSmoke3 = this.smoke3;
        this.smoke1Black.style.opacity = 0;
        this.smoke2Black.style.opacity = 0;
        this.smoke3Black.style.opacity = 0;
      } else {
        this.activeSmoke1 = this.smoke1Black;
        this.activeSmoke2 = this.smoke2Black;
        this.activeSmoke3 = this.smoke3Black;
        this.smoke1.style.opacity = 0;
        this.smoke3.style.opacity = 0;
        this.smoke3.style.opacity = 0;
      } // Показываем скроллбар


      this.progressBar.style.width = this.calcScrollPercent() + '%'; // Если мы находимся не в области просмотра секции, все слоих сверху делаем прозрачными

      if (this.calcScrollPercent() === undefined || this.calcScrollPercent() < 0 || this.calcScrollPercent() > 100) {
        this.fog.style.opacity = 0;
        this.activeSmoke1.style.opacity = 0;
        this.activeSmoke2.style.opacity = 0;
        this.activeSmoke3.style.opacity = 0;
        this.progressBar.style.width = 0;
        return;
      } // Обрабатываем скролл вниз


      if (this.direction === 'to-bottom') {
        // Для первого элемента не делаем анимаций "входа"
        if (this.sections.indexOf(this.currentSection) !== 0) {
          // Если скролл меньше 25%, то убираем прозрачность у "тумана".
          // и устанавливаем скорость транзишена, чтобы было плавно.
          if (this.calcScrollPercent() <= 25) {
            this.fog.style.transition = 'opacity 1s';
            this.fog.style.opacity = 0;
          } else {
            // Если нет, то возвращаем транзишн в стандартное положение
            this.fog.style.transition = 'opacity 0.2s';
          }
        } // Для последнего элемента не делаем анимаций "Выхода". 


        if (this.currentSection !== this.sections[this.sections.length - 1]) {
          //  Дым выход
          if (this.calcScrollPercent() >= 55) {
            this.activeSmoke1.style.opacity = 1;
          }

          if (this.calcScrollPercent() >= 65) {
            this.activeSmoke2.style.opacity = 1;
          }

          if (this.calcScrollPercent() >= 70) {
            this.activeSmoke3.style.opacity = 1;
          }

          if (this.calcScrollPercent() >= 75) {
            this.fog.style.opacity = (this.calcScrollPercent() - 75) * 5 + '%';
          }
        } // Дым вход


        if (this.calcScrollPercent() >= 5 && this.calcScrollPercent() < 40 && this.direction === 'to-bottom') {
          this.activeSmoke1.style.opacity = 0;
        }

        if (this.calcScrollPercent() >= 13 && this.calcScrollPercent() < 40 && this.direction === 'to-bottom') {
          this.activeSmoke2.style.opacity = 0;
        }

        if (this.calcScrollPercent() >= 10 && this.calcScrollPercent() < 40 && this.direction === 'to-bottom') {
          this.activeSmoke3.style.opacity = 0;
        }
      }

      if (this.direction === 'to-top') {
        // Для первого элемента не делаем анимаций "входа"
        if (this.sections.indexOf(this.currentSection) !== 0) {
          // Делаем "затенение", если идём вверх
          if (this.calcScrollPercent() <= 25) {
            // console.log(125 - this.calcScrollPercent() * 4 + '%');
            this.fog.style.opacity = 125 - this.calcScrollPercent() * 4 + '%';
          } // Дым при прокрутке вверх


          if (this.calcScrollPercent() <= 15) {
            this.activeSmoke1.style.opacity = 1;
          }

          if (this.calcScrollPercent() <= 23) {
            this.activeSmoke2.style.opacity = 1;
          }

          if (this.calcScrollPercent() <= 35) {
            this.activeSmoke3.style.opacity = 1;
          }
        }

        if (this.calcScrollPercent() >= 85) {
          this.fog.style.transition = 'opacity 1s';
          this.fog.style.opacity = 0;
        } else {
          // Если нет, то возвращаем транзишн в стандартное положение
          this.fog.style.transition = 'opacity 0.2s';
        } // Дым вверх затменение при переходе с предыдущего


        if (this.calcScrollPercent() <= 90 && this.calcScrollPercent() >= 50) {
          this.activeSmoke1.style.opacity = 0;
        }

        if (this.calcScrollPercent() <= 80 && this.calcScrollPercent() >= 50) {
          this.activeSmoke2.style.opacity = 0;
        }

        if (this.calcScrollPercent() <= 75 && this.calcScrollPercent() >= 50) {
          this.activeSmoke3.style.opacity = 0;
        }
      } // Меняем основной цвет


      if (this.calcScrollPercent() >= 40 && this.calcScrollPercent() <= 60) {
        if (this.currentSection.classList.contains('full-scroll__set-black-fog')) {
          this.setActiveTheme('black');
        } else {
          this.setActiveTheme('white');
        }
      }
    }
  }, {
    key: "setActiveTheme",
    value: function setActiveTheme() {
      var theme = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'white';

      if (theme === 'white') {
        this.colorTheme = 'white';
        this.fog.style.backgroundColor = '#fdf5e6';
      } else {
        this.colorTheme = 'black';
        this.fog.style.backgroundColor = '#030c1a';
      }
    }
  }, {
    key: "eventHendler",
    value: function eventHendler() {
      var _this3 = this;

      var offset = pageYOffset;
      document.addEventListener('scroll', function () {
        _this3.changeElementVisible();

        _this3.setAboveBgOpacity();

        if (pageYOffset - offset < 0) {
          _this3.direction = 'to-top';
        } else {
          _this3.direction = 'to-bottom';
        }

        offset = pageYOffset;
      });
    }
  }, {
    key: "toStandartScroll",
    value: function toStandartScroll() {
      this.sections.forEach(function (item) {
        item.classList.add('full-scroll__element-standard-height');
      });
    }
  }]);

  return ScreenSlider;
}();

var GetCoords = /*#__PURE__*/function () {
  function GetCoords() {
    _classCallCheck(this, GetCoords);
  }

  _createClass(GetCoords, null, [{
    key: "getCoords",
    value: function getCoords(element) {
      var box = element.getBoundingClientRect();
      return {
        top: box.top + pageYOffset,
        bottom: box.bottom + pageYOffset
      };
    }
  }]);

  return GetCoords;
}();

var sectionSlider = new ScreenSlider('full-scroll'); // const sectionSlider2 = new ScreenSlider('full-scroll2');

var anchorAdder = new AnchorAdder();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkFuY2hvckFkZGVyLmpzIiwiU2NyZWVuU2xpZGVyLmpzIiwic2hhcmVkL0dldENvb3Jkcy5qcyIsInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJBbmNob3JBZGRlciIsImhpc3RvcnkiLCJwdXNoU3RhdGUiLCJzY3JvbGxIYW5kbGVyIiwibmFtZSIsImJhc2VVcmwiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsInByb3RvY29sIiwiaG9zdCIsInBhdGhuYW1lIiwibmV3VXJsIiwiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiYW5jaG9yc0xpbmsiLCJmb3JFYWNoIiwiaXRlbSIsImFuY2hvclRvcENvb3JkIiwiR2V0Q29vcmRzIiwiZ2V0Q29vcmRzIiwidG9wIiwicGFnZVlPZmZzZXQiLCJhZGRBbmNob3IiLCJxdWVyeVNlbGVjdG9yQWxsIiwiU2NyZWVuU2xpZGVyIiwiaWQiLCJtYWluQ29udGFpbmVyIiwicXVlcnlTZWxlY3RvciIsIkVycm9yIiwic2VjdGlvbnMiLCJBcnJheSIsImZyb20iLCJmb2ciLCJzbW9rZTEiLCJzbW9rZTIiLCJzbW9rZTMiLCJzbW9rZTFCbGFjayIsInNtb2tlMkJsYWNrIiwic21va2UzQmxhY2siLCJhY3RpdmVTbW9rZTEiLCJhY3RpdmVTbW9rZTIiLCJhY3RpdmVTbW9rZTMiLCJjb2xvclRoZW1lIiwicHJvZ3Jlc3NCYXIiLCJjdXJyZW50U2VjdGlvbiIsInNjcm9sbERpcmVjdGlvbiIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwidG9TdGFuZGFydFNjcm9sbCIsImV2ZW50SGVuZGxlciIsImNoYW5nZUVsZW1lbnRWaXNpYmxlIiwiaW5kZXhPZiIsImxlbmd0aCIsIk1hdGgiLCJmbG9vciIsImNsaWVudEhlaWdodCIsImlubmVySGVpZ2h0IiwiZml4ZWRCbG9jayIsImVsZW1Db29yZHMiLCJib3R0b20iLCJhZGQiLCJyZW1vdmUiLCJzdHlsZSIsIm9wYWNpdHkiLCJ3aWR0aCIsImNhbGNTY3JvbGxQZXJjZW50IiwidW5kZWZpbmVkIiwiZGlyZWN0aW9uIiwidHJhbnNpdGlvbiIsInNldEFjdGl2ZVRoZW1lIiwidGhlbWUiLCJiYWNrZ3JvdW5kQ29sb3IiLCJvZmZzZXQiLCJzZXRBYm92ZUJnT3BhY2l0eSIsImVsZW1lbnQiLCJib3giLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJzZWN0aW9uU2xpZGVyIiwiYW5jaG9yQWRkZXIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0lBQUFBLFc7QUFDQSx5QkFBQTtBQUFBOztBQUNBLFFBQUEsQ0FBQUMsT0FBQSxDQUFBQyxTQUFBLEVBQUE7QUFDQTtBQUNBOztBQUVBLFNBQUFDLGFBQUE7QUFDQTs7Ozs4QkFFQUMsSSxFQUFBO0FBQ0EsVUFBQUMsT0FBQSxHQUFBQyxNQUFBLENBQUFDLFFBQUEsQ0FBQUMsUUFBQSxHQUFBLElBQUEsR0FBQUYsTUFBQSxDQUFBQyxRQUFBLENBQUFFLElBQUEsR0FBQUgsTUFBQSxDQUFBQyxRQUFBLENBQUFHLFFBQUE7QUFDQSxVQUFBQyxNQUFBLEdBQUFOLE9BQUEsY0FBQUQsSUFBQSxDQUFBO0FBQ0FILE1BQUFBLE9BQUEsQ0FBQUMsU0FBQSxDQUFBLElBQUEsRUFBQSxJQUFBLEVBQUFTLE1BQUE7QUFDQTs7O29DQUVBO0FBQUE7O0FBQ0FDLE1BQUFBLFFBQUEsQ0FBQUMsZ0JBQUEsQ0FBQSxRQUFBLEVBQUEsWUFBQTtBQUVBO0FBRUEsUUFBQSxLQUFBLENBQUFDLFdBQUEsQ0FBQUMsT0FBQSxDQUFBLFVBQUFDLElBQUEsRUFBQTtBQUNBLGNBQUFDLGNBQUEsR0FBQUMsU0FBQSxDQUFBQyxTQUFBLENBQUFILElBQUEsRUFBQUksR0FBQTs7QUFFQSxjQUFBQyxXQUFBLElBQUFKLGNBQUEsSUFBQUksV0FBQSxJQUFBSixjQUFBLEdBQUEsR0FBQSxFQUFBO0FBQ0EsWUFBQSxLQUFBLENBQUFLLFNBQUEsQ0FBQU4sSUFBQSxDQUFBWixJQUFBO0FBQ0E7QUFDQSxTQU5BO0FBT0EsT0FYQTtBQVlBOzs7d0JBRUE7QUFDQSxhQUFBUSxRQUFBLENBQUFXLGdCQUFBLENB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QSxDQUFBcUMsb0JBQUE7O0FBQ0EsUUFBQSxNQUFBLENBQUF1QixpQkFBQTs7QUFFQSxZQUFBcEQsV0FBQSxHQUFBbUQsTUFBQSxHQUFBLENBQUEsRUFBQTtBQUNBLFVBQUEsTUFBQSxDQUFBTCxTQUFBLEdBQUEsUUFBQTtBQUNBLFNBRkEsTUFFQTtBQUNBLFVBQUEsTUFBQSxDQUFBQSxTQUFBLEdBQUEsV0FBQTtBQUNBOztBQUNBSyxRQUFBQSxNQUFBLEdBQUFuRCxXQUFBO0FBRUEsT0FYQTtBQVlBOzs7dUNBRUE7QUFDQSxXQUFBUSxRQUFBLENBQUFkLE9BQUEsQ0FBQSxVQUFBQyxJQUFBLEVBQUE7QUFDQUEsUUFBQUEsSUFBQSxDQUFBOEIsU0FBQSxDQUFBYyxHQUFBLENBQUEsc0NBQUE7QUFDQSxPQUZBO0FBR0E7Ozs7OztJQzlQQTFDLFM7Ozs7Ozs7OEJBQ0F3RCxPLEVBQUE7QUFDQSxVQUFBQyxHQUFBLEdBQUFELE9BQUEsQ0FBQUUscUJBQUEsRUFBQTtBQUVBLGFBQUE7QUFDQXhELFFBQUFBLEdBQUEsRUFBQXVELEdBQUEsQ0FBQXZELEdBQUEsR0FBQUMsV0FEQTtBQUVBc0MsUUFBQUEsTUFBQSxFQUFBZ0IsR0FBQSxDQUFBaEIsTUFBQSxHQUFBdEM7QUFGQSxPQUFBO0FBSUE7Ozs7OztBQ05BLElBQUF3RCxhQUFBLEdBQUEsSUFBQXJELFlBQUEsQ0FBQSxhQUFBLENBQUEsQyxDQUNBOztBQUNBLElBQUFzRCxXQUFBLEdBQUEsSUFBQTlFLFdBQUEsRUFBQSIsImZpbGUiOiJzY3JpcHQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBBbmNob3JBZGRlciB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIGlmICghaGlzdG9yeS5wdXNoU3RhdGUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLnNjcm9sbEhhbmRsZXIoKTtcbiAgfVxuXG4gIGFkZEFuY2hvcihuYW1lKSB7XG4gICAgdmFyIGJhc2VVcmwgPSB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgKyBcIi8vXCIgKyB3aW5kb3cubG9jYXRpb24uaG9zdCArIHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZTtcbiAgICB2YXIgbmV3VXJsID0gYmFzZVVybCArIGAjJHtuYW1lfWA7XG4gICAgaGlzdG9yeS5wdXNoU3RhdGUobnVsbCwgbnVsbCwgbmV3VXJsKTtcbiAgfSBcblxuICBzY3JvbGxIYW5kbGVyKCkge1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsICgpID0+IHtcblxuICAgICAgLy8g0J3QsNC00L4g0LLRi9C90LXRgdGC0Lgg0LfQvdCw0YfQtdC90LjRjyDQsiDQvtGC0LTQtdC70YzQvdGL0Lkg0LzQsNGB0YHQuNCyLCDRh9GC0L7QsdGLINC90LUg0L/RgNC+0LHQtdCz0LDRgtGMINC60LDQttC00YvQuSDRgNCw0Lcg0YbQuNC60LvQvtC8XG5cbiAgICAgIHRoaXMuYW5jaG9yc0xpbmsuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgbGV0IGFuY2hvclRvcENvb3JkID0gR2V0Q29vcmRzLmdldENvb3JkcyhpdGVtKS50b3A7XG4gICAgICAgIFxuICAgICAgICBpZiAocGFnZVlPZmZzZXQgPj0gYW5jaG9yVG9wQ29vcmQgJiYgcGFnZVlPZmZzZXQgPD0gYW5jaG9yVG9wQ29vcmQgKyA1MDApIHtcbiAgICAgICAgICB0aGlzLmFkZEFuY2hvcihpdGVtLm5hbWUpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgIH0pO1xuICB9XG5cbiAgZ2V0IGFuY2hvcnNMaW5rICgpIHtcbiAgICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnYS5hbmNob3InKTtcbiAgfVxufSIsImNsYXNzIFNjcmVlblNsaWRlciB7XG4gIGNvbnN0cnVjdG9yKGlkKSB7XG4gICAgdGhpcy5tYWluQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgIyR7aWR9YCk7XG5cbiAgICBpZiAoIXRoaXMubWFpbkNvbnRhaW5lcikge1xuICAgICAgdGhyb3cobmV3IEVycm9yKCdJZCDQvdC1INC/0LXRgNC10LTQsNC9INCyINC60L7QvdGB0YLRgNGD0LrRgtC+0YAg0Y3Qu9C10LzQtdC90YLQsCBTY3JlZW5TbGlkZXIsINC70LjQsdC+INGN0LvQtdC80LXQvdGCINC90LUg0L3QsNC50LTQtdC9INC90LAg0YHRgtGA0LDQvdC40YbQtScpKTtcbiAgICB9XG5cbiAgICB0aGlzLnNlY3Rpb25zID0gQXJyYXkuZnJvbSh0aGlzLm1haW5Db250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnLmZ1bGwtc2Nyb2xsX19lbGVtZW50JykpO1xuICAgIHRoaXMuZm9nID0gdGhpcy5tYWluQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5mdWxsLXNjcm9sbF9fZm9nJyk7XG5cbiAgICB0aGlzLnNtb2tlMSA9IHRoaXMubWFpbkNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuZnVsbC1zY3JvbGxfX3Ntb2tlX2JnMScpO1xuICAgIHRoaXMuc21va2UyID0gdGhpcy5tYWluQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5mdWxsLXNjcm9sbF9fc21va2VfYmcyJyk7XG4gICAgdGhpcy5zbW9rZTMgPSB0aGlzLm1haW5Db250YWluZXIucXVlcnlTZWxlY3RvcignLmZ1bGwtc2Nyb2xsX19zbW9rZV9iZzMnKTtcblxuICAgIHRoaXMuc21va2UxQmxhY2sgPSB0aGlzLm1haW5Db250YWluZXIucXVlcnlTZWxlY3RvcignLmZ1bGwtc2Nyb2xsX19zbW9rZV9iZzEtYmxhY2snKTtcbiAgICB0aGlzLnNtb2tlMkJsYWNrID0gdGhpcy5tYWluQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5mdWxsLXNjcm9sbF9fc21va2VfYmcyLWJsYWNrJyk7XG4gICAgdGhpcy5zbW9rZTNCbGFjayA9IHRoaXMubWFpbkNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuZnVsbC1zY3JvbGxfX3Ntb2tlX2JnMy1ibGFjaycpO1xuICAgIFxuICAgIHRoaXMuYWN0aXZlU21va2UxO1xuICAgIHRoaXMuYWN0aXZlU21va2UyO1xuICAgIHRoaXMuYWN0aXZlU21va2UzO1xuXG4gICAgdGhpcy5jb2xvclRoZW1lID0gJ3doaXRlJztcblxuICAgIHRoaXMucHJvZ3Jlc3NCYXIgPSB0aGlzLm1haW5Db250YWluZXIucXVlcnlTZWxlY3RvcignLmZ1bGwtc2Nyb2xsX19wcm9ncmVzcy1iYXInKTtcblxuICAgIHRoaXMuY3VycmVudFNlY3Rpb24gPSAnJztcbiAgICB0aGlzLnNjcm9sbERpcmVjdGlvbjtcblxuICAgIGlmICh0aGlzLm1haW5Db250YWluZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdmdWxsLXNjcm9sbF9fdG8tc3RhbmRhcnQtc2Nyb2xsJykpIHtcbiAgICAgIHRoaXMudG9TdGFuZGFydFNjcm9sbCgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuZXZlbnRIZW5kbGVyKCk7XG4gICAgdGhpcy5jaGFuZ2VFbGVtZW50VmlzaWJsZSgpO1xuICAgIFxuICB9XG4gIFxuICBjYWxjU2Nyb2xsUGVyY2VudCgpIHtcbiAgICAvLyBjb25zb2xlLmxvZyh0aGlzLnNlY3Rpb25zLmluZGV4T2YodGhpcy5jdXJyZW50U2VjdGlvbikpXG4gICAgaWYgKHRoaXMuc2VjdGlvbnMuaW5kZXhPZih0aGlzLmN1cnJlbnRTZWN0aW9uKSA9PT0gdGhpcy5zZWN0aW9ucy5sZW5ndGggLSAxKSB7XG4gICAgICByZXR1cm4gTWF0aC5mbG9vcigocGFnZVlPZmZzZXQgLSBHZXRDb29yZHMuZ2V0Q29vcmRzKHRoaXMuY3VycmVudFNlY3Rpb24pLnRvcCkgLyAodGhpcy5jdXJyZW50U2VjdGlvbi5jbGllbnRIZWlnaHQgLSB3aW5kb3cuaW5uZXJIZWlnaHQpICAqIDEwMCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuY3VycmVudFNlY3Rpb24pIHtcbiAgICAgIHJldHVybiBNYXRoLmZsb29yKChwYWdlWU9mZnNldCAtIEdldENvb3Jkcy5nZXRDb29yZHModGhpcy5jdXJyZW50U2VjdGlvbikudG9wKSAvIHRoaXMuY3VycmVudFNlY3Rpb24uY2xpZW50SGVpZ2h0ICogMTAwKTtcbiAgICB9XG4gIH1cbiAgY2hhbmdlRWxlbWVudFZpc2libGUoKSB7XG4gICAgdGhpcy5zZWN0aW9ucy5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgY29uc3QgZml4ZWRCbG9jayA9IGl0ZW0ucXVlcnlTZWxlY3RvcignLmZ1bGwtc2Nyb2xsX19maXhlZC13cmFwcGVyJyk7XG4gICAgICBjb25zdCBlbGVtQ29vcmRzID0gR2V0Q29vcmRzLmdldENvb3JkcyhpdGVtKTtcbiAgICAgIGlmIChwYWdlWU9mZnNldCA+PSBlbGVtQ29vcmRzLnRvcCAmJiBlbGVtQ29vcmRzLmJvdHRvbSA+PSBwYWdlWU9mZnNldCkge1xuICAgICAgICB0aGlzLmN1cnJlbnRTZWN0aW9uID0gaXRlbTtcbiAgICAgICAgZml4ZWRCbG9jay5jbGFzc0xpc3QuYWRkKCdmdWxsLXNjcm9sbF9fZml4LXN0YXRlJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBmaXhlZEJsb2NrLmNsYXNzTGlzdC5yZW1vdmUoJ2Z1bGwtc2Nyb2xsX19maXgtc3RhdGUnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuY3VycmVudFNlY3Rpb24gPT09IHRoaXMuc2VjdGlvbnNbdGhpcy5zZWN0aW9ucy5sZW5ndGggLSAxXSkge1xuICAgICAgICBpZiAocGFnZVlPZmZzZXQgPj0gR2V0Q29vcmRzLmdldENvb3Jkcyh0aGlzLmN1cnJlbnRTZWN0aW9uKS5ib3R0b20gLSB3aW5kb3cuaW5uZXJIZWlnaHQpIHtcbiAgICAgICAgICBmaXhlZEJsb2NrLmNsYXNzTGlzdC5yZW1vdmUoJ2Z1bGwtc2Nyb2xsX19maXgtc3RhdGUnKTtcbiAgICAgICAgICBmaXhlZEJsb2NrLmNsYXNzTGlzdC5hZGQoJ2Z1bGwtc2Nyb2xsX19sYXN0LWVsZW0nKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBmaXhlZEJsb2NrLmNsYXNzTGlzdC5yZW1vdmUoJ2Z1bGwtc2Nyb2xsX19sYXN0LWVsZW0nKTtcbiAgICAgICAgfVxuICAgICAgfSBcbiAgICB9KTtcbiAgfVxuICBcbiAgXG4gIHNldEFib3ZlQmdPcGFjaXR5KCkge1xuXG4gICAgaWYgKHRoaXMuY29sb3JUaGVtZSA9PT0gJ3doaXRlJykge1xuICAgICAgdGhpcy5hY3RpdmVTbW9rZTEgPSB0aGlzLnNtb2tlMTtcbiAgICAgIHRoaXMuYWN0aXZlU21va2UyID0gdGhpcy5zbW9rZTI7XG4gICAgICB0aGlzLmFjdGl2ZVNtb2tlMyA9IHRoaXMuc21va2UzO1xuXG4gICAgICB0aGlzLnNtb2tlMUJsYWNrLnN0eWxlLm9wYWNpdHkgPSAwO1xuICAgICAgdGhpcy5zbW9rZTJCbGFjay5zdHlsZS5vcGFjaXR5ID0gMDtcbiAgICAgIHRoaXMuc21va2UzQmxhY2suc3R5bGUub3BhY2l0eSA9IDA7XG5cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5hY3RpdmVTbW9rZTEgPSB0aGlzLnNtb2tlMUJsYWNrO1xuICAgICAgdGhpcy5hY3RpdmVTbW9rZTIgPSB0aGlzLnNtb2tlMkJsYWNrO1xuICAgICAgdGhpcy5hY3RpdmVTbW9rZTMgPSB0aGlzLnNtb2tlM0JsYWNrO1xuXG4gICAgICB0aGlzLnNtb2tlMS5zdHlsZS5vcGFjaXR5ID0gMDtcbiAgICAgIHRoaXMuc21va2UzLnN0eWxlLm9wYWNpdHkgPSAwO1xuICAgICAgdGhpcy5zbW9rZTMuc3R5bGUub3BhY2l0eSA9IDA7XG4gICAgfVxuXG5cbiAgICAvLyDQn9C+0LrQsNC30YvQstCw0LXQvCDRgdC60YDQvtC70LvQsdCw0YBcbiAgICB0aGlzLnByb2dyZXNzQmFyLnN0eWxlLndpZHRoID0gdGhpcy5jYWxjU2Nyb2xsUGVyY2VudCgpICsgJyUnO1xuICAgIFxuICAgIC8vINCV0YHQu9C4INC80Ysg0L3QsNGF0L7QtNC40LzRgdGPINC90LUg0LIg0L7QsdC70LDRgdGC0Lgg0L/RgNC+0YHQvNC+0YLRgNCwINGB0LXQutGG0LjQuCwg0LLRgdC1INGB0LvQvtC40YUg0YHQstC10YDRhdGDINC00LXQu9Cw0LXQvCDQv9GA0L7Qt9GA0LDRh9C90YvQvNC4XG4gICAgaWYgKHRoaXMuY2FsY1Njcm9sbFBlcmNlbnQoKSA9PT0gdW5kZWZpbmVkIHx8IHRoaXMuY2FsY1Njcm9sbFBlcmNlbnQoKSA8IDAgfHwgdGhpcy5jYWxjU2Nyb2xsUGVyY2VudCgpID4gMTAwKSB7XG4gICAgICB0aGlzLmZvZy5zdHlsZS5vcGFjaXR5ID0gMDtcbiAgICAgIHRoaXMuYWN0aXZlU21va2UxLnN0eWxlLm9wYWNpdHkgPSAwO1xuICAgICAgdGhpcy5hY3RpdmVTbW9rZTIuc3R5bGUub3BhY2l0eSA9IDA7XG4gICAgICB0aGlzLmFjdGl2ZVNtb2tlMy5zdHlsZS5vcGFjaXR5ID0gMDtcblxuICAgICAgdGhpcy5wcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9IDA7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8g0J7QsdGA0LDQsdCw0YLRi9Cy0LDQtdC8INGB0LrRgNC+0LvQuyDQstC90LjQt1xuICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PT0gJ3RvLWJvdHRvbScpIHtcblxuICAgICAgLy8g0JTQu9GPINC/0LXRgNCy0L7Qs9C+INGN0LvQtdC80LXQvdGC0LAg0L3QtSDQtNC10LvQsNC10Lwg0LDQvdC40LzQsNGG0LjQuSBcItCy0YXQvtC00LBcIlxuICAgICAgaWYgKHRoaXMuc2VjdGlvbnMuaW5kZXhPZih0aGlzLmN1cnJlbnRTZWN0aW9uKSAhPT0gMCkge1xuXG4gICAgICAgIC8vINCV0YHQu9C4INGB0LrRgNC+0LvQuyDQvNC10L3RjNGI0LUgMjUlLCDRgtC+INGD0LHQuNGA0LDQtdC8INC/0YDQvtC30YDQsNGH0L3QvtGB0YLRjCDRgyBcItGC0YPQvNCw0L3QsFwiLlxuICAgICAgICAvLyDQuCDRg9GB0YLQsNC90LDQstC70LjQstCw0LXQvCDRgdC60L7RgNC+0YHRgtGMINGC0YDQsNC90LfQuNGI0LXQvdCwLCDRh9GC0L7QsdGLINCx0YvQu9C+INC/0LvQsNCy0L3Qvi5cbiAgICAgICAgaWYgKHRoaXMuY2FsY1Njcm9sbFBlcmNlbnQoKSA8PSAyNSkge1xuICAgICAgICAgIHRoaXMuZm9nLnN0eWxlLnRyYW5zaXRpb24gPSAnb3BhY2l0eSAxcyc7XG4gICAgICAgICAgdGhpcy5mb2cuc3R5bGUub3BhY2l0eSA9IDA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8g0JXRgdC70Lgg0L3QtdGCLCDRgtC+INCy0L7Qt9Cy0YDQsNGJ0LDQtdC8INGC0YDQsNC90LfQuNGI0L0g0LIg0YHRgtCw0L3QtNCw0YDRgtC90L7QtSDQv9C+0LvQvtC20LXQvdC40LVcbiAgICAgICAgICB0aGlzLmZvZy5zdHlsZS50cmFuc2l0aW9uID0gJ29wYWNpdHkgMC4ycyc7XG4gICAgICAgIH1cbiAgICAgIH1cblxuXG4gICAgICAvLyDQlNC70Y8g0L/QvtGB0LvQtdC00L3QtdCz0L4g0Y3Qu9C10LzQtdC90YLQsCDQvdC1INC00LXQu9Cw0LXQvCDQsNC90LjQvNCw0YbQuNC5IFwi0JLRi9GF0L7QtNCwXCIuIFxuICAgICAgaWYgKHRoaXMuY3VycmVudFNlY3Rpb24gIT09IHRoaXMuc2VjdGlvbnNbdGhpcy5zZWN0aW9ucy5sZW5ndGggLSAxXSkge1xuXG4gICAgICAgIC8vICDQlNGL0Lwg0LLRi9GF0L7QtFxuICAgICAgICBpZiAodGhpcy5jYWxjU2Nyb2xsUGVyY2VudCgpID49IDU1KSB7XG4gICAgICAgICAgdGhpcy5hY3RpdmVTbW9rZTEuc3R5bGUub3BhY2l0eSA9IDE7XG4gICAgICAgIH0gXG5cbiAgICAgICAgaWYgKHRoaXMuY2FsY1Njcm9sbFBlcmNlbnQoKSA+PSA2NSkge1xuICAgICAgICAgIHRoaXMuYWN0aXZlU21va2UyLnN0eWxlLm9wYWNpdHkgPSAxO1xuICAgICAgICB9IFxuXG4gICAgICAgIGlmICh0aGlzLmNhbGNTY3JvbGxQZXJjZW50KCkgPj0gNzApIHtcbiAgICAgICAgICB0aGlzLmFjdGl2ZVNtb2tlMy5zdHlsZS5vcGFjaXR5ID0gMTtcbiAgICAgICAgfSBcblxuICAgICAgICBpZiAodGhpcy5jYWxjU2Nyb2xsUGVyY2VudCgpID49IDc1KSB7XG4gICAgICAgICAgdGhpcy5mb2cuc3R5bGUub3BhY2l0eSA9ICh0aGlzLmNhbGNTY3JvbGxQZXJjZW50KCkgLSA3NSkgKiA1ICsgJyUnO1xuICAgICAgICB9IFxuICAgICAgfVxuXG5cbiAgICAgIC8vINCU0YvQvCDQstGF0L7QtFxuICAgICAgaWYgKHRoaXMuY2FsY1Njcm9sbFBlcmNlbnQoKSA+PSA1ICYmIHRoaXMuY2FsY1Njcm9sbFBlcmNlbnQoKSA8IDQwICYmIHRoaXMuZGlyZWN0aW9uID09PSAndG8tYm90dG9tJykge1xuICAgICAgICB0aGlzLmFjdGl2ZVNtb2tlMS5zdHlsZS5vcGFjaXR5ID0gMDtcbiAgICAgIH0gXG5cbiAgICAgIGlmICh0aGlzLmNhbGNTY3JvbGxQZXJjZW50KCkgPj0gMTMgJiYgdGhpcy5jYWxjU2Nyb2xsUGVyY2VudCgpIDwgNDAgJiYgdGhpcy5kaXJlY3Rpb24gPT09ICd0by1ib3R0b20nKSB7XG4gICAgICAgIHRoaXMuYWN0aXZlU21va2UyLnN0eWxlLm9wYWNpdHkgPSAwO1xuICAgICAgfSBcblxuICAgICAgaWYgKHRoaXMuY2FsY1Njcm9sbFBlcmNlbnQoKSA+PSAxMCAmJiB0aGlzLmNhbGNTY3JvbGxQZXJjZW50KCkgPCA0MCAmJiB0aGlzLmRpcmVjdGlvbiA9PT0gJ3RvLWJvdHRvbScpIHtcbiAgICAgICAgdGhpcy5hY3RpdmVTbW9rZTMuc3R5bGUub3BhY2l0eSA9IDA7XG4gICAgICB9IFxuXG4gICAgfVxuXG5cbiAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT09ICd0by10b3AnKSB7XG4gICAgICAvLyDQlNC70Y8g0L/QtdGA0LLQvtCz0L4g0Y3Qu9C10LzQtdC90YLQsCDQvdC1INC00LXQu9Cw0LXQvCDQsNC90LjQvNCw0YbQuNC5IFwi0LLRhdC+0LTQsFwiXG4gICAgICBcbiAgICAgIGlmICh0aGlzLnNlY3Rpb25zLmluZGV4T2YodGhpcy5jdXJyZW50U2VjdGlvbikgIT09IDApIHtcblxuICAgICAgICAvLyDQlNC10LvQsNC10LwgXCLQt9Cw0YLQtdC90LXQvdC40LVcIiwg0LXRgdC70Lgg0LjQtNGR0Lwg0LLQstC10YDRhVxuICAgICAgICBpZiAodGhpcy5jYWxjU2Nyb2xsUGVyY2VudCgpIDw9IDI1KSB7XG4gICAgICAgICAgLy8gY29uc29sZS5sb2coMTI1IC0gdGhpcy5jYWxjU2Nyb2xsUGVyY2VudCgpICogNCArICclJyk7XG4gICAgICAgICAgdGhpcy5mb2cuc3R5bGUub3BhY2l0eSA9IDEyNSAtIHRoaXMuY2FsY1Njcm9sbFBlcmNlbnQoKSAqIDQgKyAnJSc7XG4gICAgICAgIH0gXG5cbiAgICAgICAgLy8g0JTRi9C8INC/0YDQuCDQv9GA0L7QutGA0YPRgtC60LUg0LLQstC10YDRhVxuICAgICAgICBpZiAodGhpcy5jYWxjU2Nyb2xsUGVyY2VudCgpIDw9IDE1KSB7XG4gICAgICAgICAgdGhpcy5hY3RpdmVTbW9rZTEuc3R5bGUub3BhY2l0eSA9IDE7XG4gICAgICAgIH0gXG5cbiAgICAgICAgaWYgKHRoaXMuY2FsY1Njcm9sbFBlcmNlbnQoKSA8PSAyMykge1xuICAgICAgICAgIHRoaXMuYWN0aXZlU21va2UyLnN0eWxlLm9wYWNpdHkgPSAxO1xuICAgICAgICB9IFxuXG4gICAgICAgIGlmICh0aGlzLmNhbGNTY3JvbGxQZXJjZW50KCkgPD0gMzUpIHtcbiAgICAgICAgICB0aGlzLmFjdGl2ZVNtb2tlMy5zdHlsZS5vcGFjaXR5ID0gMTtcbiAgICAgICAgfSBcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuY2FsY1Njcm9sbFBlcmNlbnQoKSA+PSA4NSkge1xuICAgICAgICB0aGlzLmZvZy5zdHlsZS50cmFuc2l0aW9uID0gJ29wYWNpdHkgMXMnO1xuICAgICAgICB0aGlzLmZvZy5zdHlsZS5vcGFjaXR5ID0gMDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vINCV0YHQu9C4INC90LXRgiwg0YLQviDQstC+0LfQstGA0LDRidCw0LXQvCDRgtGA0LDQvdC30LjRiNC9INCyINGB0YLQsNC90LTQsNGA0YLQvdC+0LUg0L/QvtC70L7QttC10L3QuNC1XG4gICAgICAgIHRoaXMuZm9nLnN0eWxlLnRyYW5zaXRpb24gPSAnb3BhY2l0eSAwLjJzJztcbiAgICAgIH1cblxuICAgICAgLy8g0JTRi9C8INCy0LLQtdGA0YUg0LfQsNGC0LzQtdC90LXQvdC40LUg0L/RgNC4INC/0LXRgNC10YXQvtC00LUg0YEg0L/RgNC10LTRi9C00YPRidC10LPQvlxuICAgICAgaWYgKHRoaXMuY2FsY1Njcm9sbFBlcmNlbnQoKSA8PSA5MCAmJiB0aGlzLmNhbGNTY3JvbGxQZXJjZW50KCkgPj0gNTApIHtcbiAgICAgICAgdGhpcy5hY3RpdmVTbW9rZTEuc3R5bGUub3BhY2l0eSA9IDA7XG4gICAgICB9IFxuICBcbiAgICAgIGlmICh0aGlzLmNhbGNTY3JvbGxQZXJjZW50KCkgPD0gODAgJiYgdGhpcy5jYWxjU2Nyb2xsUGVyY2VudCgpID49IDUwKSB7XG4gICAgICAgIHRoaXMuYWN0aXZlU21va2UyLnN0eWxlLm9wYWNpdHkgPSAwO1xuICAgICAgfSBcbiAgXG4gICAgICBpZiAodGhpcy5jYWxjU2Nyb2xsUGVyY2VudCgpIDw9IDc1ICYmIHRoaXMuY2FsY1Njcm9sbFBlcmNlbnQoKSA+PSA1MCkge1xuICAgICAgICB0aGlzLmFjdGl2ZVNtb2tlMy5zdHlsZS5vcGFjaXR5ID0gMDtcbiAgICAgIH0gXG4gICAgICBcbiAgICB9XG5cbiAgICAvLyDQnNC10L3Rj9C10Lwg0L7RgdC90L7QstC90L7QuSDRhtCy0LXRglxuICAgIGlmICh0aGlzLmNhbGNTY3JvbGxQZXJjZW50KCkgPj0gNDAgJiYgdGhpcy5jYWxjU2Nyb2xsUGVyY2VudCgpIDw9IDYwKSB7XG4gICAgICBpZiAodGhpcy5jdXJyZW50U2VjdGlvbi5jbGFzc0xpc3QuY29udGFpbnMoJ2Z1bGwtc2Nyb2xsX19zZXQtYmxhY2stZm9nJykpIHtcbiAgICAgICAgdGhpcy5zZXRBY3RpdmVUaGVtZSgnYmxhY2snKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc2V0QWN0aXZlVGhlbWUoJ3doaXRlJyk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgc2V0QWN0aXZlVGhlbWUodGhlbWUgPSAnd2hpdGUnKSB7XG4gICAgaWYgKHRoZW1lID09PSAnd2hpdGUnKSB7XG4gICAgICB0aGlzLmNvbG9yVGhlbWUgPSAnd2hpdGUnO1xuICAgICAgdGhpcy5mb2cuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyNmZGY1ZTYnO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNvbG9yVGhlbWUgPSAnYmxhY2snO1xuICAgICAgdGhpcy5mb2cuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyMwMzBjMWEnO1xuICAgIH1cbiAgfVxuXG4gIGV2ZW50SGVuZGxlcigpIHtcbiAgICBsZXQgb2Zmc2V0ID0gcGFnZVlPZmZzZXQ7XG4gICAgXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgKCkgPT4ge1xuICAgICAgdGhpcy5jaGFuZ2VFbGVtZW50VmlzaWJsZSgpO1xuICAgICAgdGhpcy5zZXRBYm92ZUJnT3BhY2l0eSgpO1xuICAgICAgXG4gICAgICBpZiAocGFnZVlPZmZzZXQgLSBvZmZzZXQgPCAwKSB7XG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gJ3RvLXRvcCc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9ICd0by1ib3R0b20nO1xuICAgICAgfVxuICAgICAgb2Zmc2V0ID0gcGFnZVlPZmZzZXQ7XG5cbiAgICB9KTtcbiAgfVxuXG4gIHRvU3RhbmRhcnRTY3JvbGwoKSB7XG4gICAgdGhpcy5zZWN0aW9ucy5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgaXRlbS5jbGFzc0xpc3QuYWRkKCdmdWxsLXNjcm9sbF9fZWxlbWVudC1zdGFuZGFyZC1oZWlnaHQnKTtcbiAgICB9KTtcbiAgfVxufSIsImNsYXNzIEdldENvb3JkcyB7XG4gIHN0YXRpYyBnZXRDb29yZHMoZWxlbWVudCkge1xuICAgIGNvbnN0IGJveCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgIFxuICAgIHJldHVybiB7XG4gICAgICB0b3A6IGJveC50b3AgKyBwYWdlWU9mZnNldCwgXG4gICAgICBib3R0b206IGJveC5ib3R0b20gKyBwYWdlWU9mZnNldCAgXG4gICAgfTsgXG4gIH0gXG59IiwiY2xhc3MgQW5jaG9yQWRkZXIge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBpZiAoIWhpc3RvcnkucHVzaFN0YXRlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5zY3JvbGxIYW5kbGVyKCk7XG4gIH1cblxuICBhZGRBbmNob3IobmFtZSkge1xuICAgIHZhciBiYXNlVXJsID0gd2luZG93LmxvY2F0aW9uLnByb3RvY29sICsgXCIvL1wiICsgd2luZG93LmxvY2F0aW9uLmhvc3QgKyB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWU7XG4gICAgdmFyIG5ld1VybCA9IGJhc2VVcmwgKyBgIyR7bmFtZX1gO1xuICAgIGhpc3RvcnkucHVzaFN0YXRlKG51bGwsIG51bGwsIG5ld1VybCk7XG4gIH0gXG5cbiAgc2Nyb2xsSGFuZGxlcigpIHtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCAoKSA9PiB7XG5cbiAgICAgIC8vINCd0LDQtNC+INCy0YvQvdC10YHRgtC4INC30L3QsNGH0LXQvdC40Y8g0LIg0L7RgtC00LXQu9GM0L3Ri9C5INC80LDRgdGB0LjQsiwg0YfRgtC+0LHRiyDQvdC1INC/0YDQvtCx0LXQs9Cw0YLRjCDQutCw0LbQtNGL0Lkg0YDQsNC3INGG0LjQutC70L7QvFxuXG4gICAgICB0aGlzLmFuY2hvcnNMaW5rLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgIGxldCBhbmNob3JUb3BDb29yZCA9IEdldENvb3Jkcy5nZXRDb29yZHMoaXRlbSkudG9wO1xuICAgICAgICBcbiAgICAgICAgaWYgKHBhZ2VZT2Zmc2V0ID49IGFuY2hvclRvcENvb3JkICYmIHBhZ2VZT2Zmc2V0IDw9IGFuY2hvclRvcENvb3JkICsgNTAwKSB7XG4gICAgICAgICAgdGhpcy5hZGRBbmNob3IoaXRlbS5uYW1lKTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9KTtcbiAgfVxuXG4gIGdldCBhbmNob3JzTGluayAoKSB7XG4gICAgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2EuYW5jaG9yJyk7XG4gIH1cbn1cbmNsYXNzIFNjcmVlblNsaWRlciB7XG4gIGNvbnN0cnVjdG9yKGlkKSB7XG4gICAgdGhpcy5tYWluQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgIyR7aWR9YCk7XG5cbiAgICBpZiAoIXRoaXMubWFpbkNvbnRhaW5lcikge1xuICAgICAgdGhyb3cobmV3IEVycm9yKCdJZCDQvdC1INC/0LXRgNC10LTQsNC9INCyINC60L7QvdGB0YLRgNGD0LrRgtC+0YAg0Y3Qu9C10LzQtdC90YLQsCBTY3JlZW5TbGlkZXIsINC70LjQsdC+INGN0LvQtdC80LXQvdGCINC90LUg0L3QsNC50LTQtdC9INC90LAg0YHRgtGA0LDQvdC40YbQtScpKTtcbiAgICB9XG5cbiAgICB0aGlzLnNlY3Rpb25zID0gQXJyYXkuZnJvbSh0aGlzLm1haW5Db250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnLmZ1bGwtc2Nyb2xsX19lbGVtZW50JykpO1xuICAgIHRoaXMuZm9nID0gdGhpcy5tYWluQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5mdWxsLXNjcm9sbF9fZm9nJyk7XG5cbiAgICB0aGlzLnNtb2tlMSA9IHRoaXMubWFpbkNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuZnVsbC1zY3JvbGxfX3Ntb2tlX2JnMScpO1xuICAgIHRoaXMuc21va2UyID0gdGhpcy5tYWluQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5mdWxsLXNjcm9sbF9fc21va2VfYmcyJyk7XG4gICAgdGhpcy5zbW9rZTMgPSB0aGlzLm1haW5Db250YWluZXIucXVlcnlTZWxlY3RvcignLmZ1bGwtc2Nyb2xsX19zbW9rZV9iZzMnKTtcblxuICAgIHRoaXMuc21va2UxQmxhY2sgPSB0aGlzLm1haW5Db250YWluZXIucXVlcnlTZWxlY3RvcignLmZ1bGwtc2Nyb2xsX19zbW9rZV9iZzEtYmxhY2snKTtcbiAgICB0aGlzLnNtb2tlMkJsYWNrID0gdGhpcy5tYWluQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5mdWxsLXNjcm9sbF9fc21va2VfYmcyLWJsYWNrJyk7XG4gICAgdGhpcy5zbW9rZTNCbGFjayA9IHRoaXMubWFpbkNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuZnVsbC1zY3JvbGxfX3Ntb2tlX2JnMy1ibGFjaycpO1xuICAgIFxuICAgIHRoaXMuYWN0aXZlU21va2UxO1xuICAgIHRoaXMuYWN0aXZlU21va2UyO1xuICAgIHRoaXMuYWN0aXZlU21va2UzO1xuXG4gICAgdGhpcy5jb2xvclRoZW1lID0gJ3doaXRlJztcblxuICAgIHRoaXMucHJvZ3Jlc3NCYXIgPSB0aGlzLm1haW5Db250YWluZXIucXVlcnlTZWxlY3RvcignLmZ1bGwtc2Nyb2xsX19wcm9ncmVzcy1iYXInKTtcblxuICAgIHRoaXMuY3VycmVudFNlY3Rpb24gPSAnJztcbiAgICB0aGlzLnNjcm9sbERpcmVjdGlvbjtcblxuICAgIGlmICh0aGlzLm1haW5Db250YWluZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdmdWxsLXNjcm9sbF9fdG8tc3RhbmRhcnQtc2Nyb2xsJykpIHtcbiAgICAgIHRoaXMudG9TdGFuZGFydFNjcm9sbCgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuZXZlbnRIZW5kbGVyKCk7XG4gICAgdGhpcy5jaGFuZ2VFbGVtZW50VmlzaWJsZSgpO1xuICAgIFxuICB9XG4gIFxuICBjYWxjU2Nyb2xsUGVyY2VudCgpIHtcbiAgICAvLyBjb25zb2xlLmxvZyh0aGlzLnNlY3Rpb25zLmluZGV4T2YodGhpcy5jdXJyZW50U2VjdGlvbikpXG4gICAgaWYgKHRoaXMuc2VjdGlvbnMuaW5kZXhPZih0aGlzLmN1cnJlbnRTZWN0aW9uKSA9PT0gdGhpcy5zZWN0aW9ucy5sZW5ndGggLSAxKSB7XG4gICAgICByZXR1cm4gTWF0aC5mbG9vcigocGFnZVlPZmZzZXQgLSBHZXRDb29yZHMuZ2V0Q29vcmRzKHRoaXMuY3VycmVudFNlY3Rpb24pLnRvcCkgLyAodGhpcy5jdXJyZW50U2VjdGlvbi5jbGllbnRIZWlnaHQgLSB3aW5kb3cuaW5uZXJIZWlnaHQpICAqIDEwMCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuY3VycmVudFNlY3Rpb24pIHtcbiAgICAgIHJldHVybiBNYXRoLmZsb29yKChwYWdlWU9mZnNldCAtIEdldENvb3Jkcy5nZXRDb29yZHModGhpcy5jdXJyZW50U2VjdGlvbikudG9wKSAvIHRoaXMuY3VycmVudFNlY3Rpb24uY2xpZW50SGVpZ2h0ICogMTAwKTtcbiAgICB9XG4gIH1cbiAgY2hhbmdlRWxlbWVudFZpc2libGUoKSB7XG4gICAgdGhpcy5zZWN0aW9ucy5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgY29uc3QgZml4ZWRCbG9jayA9IGl0ZW0ucXVlcnlTZWxlY3RvcignLmZ1bGwtc2Nyb2xsX19maXhlZC13cmFwcGVyJyk7XG4gICAgICBjb25zdCBlbGVtQ29vcmRzID0gR2V0Q29vcmRzLmdldENvb3JkcyhpdGVtKTtcbiAgICAgIGlmIChwYWdlWU9mZnNldCA+PSBlbGVtQ29vcmRzLnRvcCAmJiBlbGVtQ29vcmRzLmJvdHRvbSA+PSBwYWdlWU9mZnNldCkge1xuICAgICAgICB0aGlzLmN1cnJlbnRTZWN0aW9uID0gaXRlbTtcbiAgICAgICAgZml4ZWRCbG9jay5jbGFzc0xpc3QuYWRkKCdmdWxsLXNjcm9sbF9fZml4LXN0YXRlJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBmaXhlZEJsb2NrLmNsYXNzTGlzdC5yZW1vdmUoJ2Z1bGwtc2Nyb2xsX19maXgtc3RhdGUnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuY3VycmVudFNlY3Rpb24gPT09IHRoaXMuc2VjdGlvbnNbdGhpcy5zZWN0aW9ucy5sZW5ndGggLSAxXSkge1xuICAgICAgICBpZiAocGFnZVlPZmZzZXQgPj0gR2V0Q29vcmRzLmdldENvb3Jkcyh0aGlzLmN1cnJlbnRTZWN0aW9uKS5ib3R0b20gLSB3aW5kb3cuaW5uZXJIZWlnaHQpIHtcbiAgICAgICAgICBmaXhlZEJsb2NrLmNsYXNzTGlzdC5yZW1vdmUoJ2Z1bGwtc2Nyb2xsX19maXgtc3RhdGUnKTtcbiAgICAgICAgICBmaXhlZEJsb2NrLmNsYXNzTGlzdC5hZGQoJ2Z1bGwtc2Nyb2xsX19sYXN0LWVsZW0nKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBmaXhlZEJsb2NrLmNsYXNzTGlzdC5yZW1vdmUoJ2Z1bGwtc2Nyb2xsX19sYXN0LWVsZW0nKTtcbiAgICAgICAgfVxuICAgICAgfSBcbiAgICB9KTtcbiAgfVxuICBcbiAgXG4gIHNldEFib3ZlQmdPcGFjaXR5KCkge1xuXG4gICAgaWYgKHRoaXMuY29sb3JUaGVtZSA9PT0gJ3doaXRlJykge1xuICAgICAgdGhpcy5hY3RpdmVTbW9rZTEgPSB0aGlzLnNtb2tlMTtcbiAgICAgIHRoaXMuYWN0aXZlU21va2UyID0gdGhpcy5zbW9rZTI7XG4gICAgICB0aGlzLmFjdGl2ZVNtb2tlMyA9IHRoaXMuc21va2UzO1xuXG4gICAgICB0aGlzLnNtb2tlMUJsYWNrLnN0eWxlLm9wYWNpdHkgPSAwO1xuICAgICAgdGhpcy5zbW9rZTJCbGFjay5zdHlsZS5vcGFjaXR5ID0gMDtcbiAgICAgIHRoaXMuc21va2UzQmxhY2suc3R5bGUub3BhY2l0eSA9IDA7XG5cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5hY3RpdmVTbW9rZTEgPSB0aGlzLnNtb2tlMUJsYWNrO1xuICAgICAgdGhpcy5hY3RpdmVTbW9rZTIgPSB0aGlzLnNtb2tlMkJsYWNrO1xuICAgICAgdGhpcy5hY3RpdmVTbW9rZTMgPSB0aGlzLnNtb2tlM0JsYWNrO1xuXG4gICAgICB0aGlzLnNtb2tlMS5zdHlsZS5vcGFjaXR5ID0gMDtcbiAgICAgIHRoaXMuc21va2UzLnN0eWxlLm9wYWNpdHkgPSAwO1xuICAgICAgdGhpcy5zbW9rZTMuc3R5bGUub3BhY2l0eSA9IDA7XG4gICAgfVxuXG5cbiAgICAvLyDQn9C+0LrQsNC30YvQstCw0LXQvCDRgdC60YDQvtC70LvQsdCw0YBcbiAgICB0aGlzLnByb2dyZXNzQmFyLnN0eWxlLndpZHRoID0gdGhpcy5jYWxjU2Nyb2xsUGVyY2VudCgpICsgJyUnO1xuICAgIFxuICAgIC8vINCV0YHQu9C4INC80Ysg0L3QsNGF0L7QtNC40LzRgdGPINC90LUg0LIg0L7QsdC70LDRgdGC0Lgg0L/RgNC+0YHQvNC+0YLRgNCwINGB0LXQutGG0LjQuCwg0LLRgdC1INGB0LvQvtC40YUg0YHQstC10YDRhdGDINC00LXQu9Cw0LXQvCDQv9GA0L7Qt9GA0LDRh9C90YvQvNC4XG4gICAgaWYgKHRoaXMuY2FsY1Njcm9sbFBlcmNlbnQoKSA9PT0gdW5kZWZpbmVkIHx8IHRoaXMuY2FsY1Njcm9sbFBlcmNlbnQoKSA8IDAgfHwgdGhpcy5jYWxjU2Nyb2xsUGVyY2VudCgpID4gMTAwKSB7XG4gICAgICB0aGlzLmZvZy5zdHlsZS5vcGFjaXR5ID0gMDtcbiAgICAgIHRoaXMuYWN0aXZlU21va2UxLnN0eWxlLm9wYWNpdHkgPSAwO1xuICAgICAgdGhpcy5hY3RpdmVTbW9rZTIuc3R5bGUub3BhY2l0eSA9IDA7XG4gICAgICB0aGlzLmFjdGl2ZVNtb2tlMy5zdHlsZS5vcGFjaXR5ID0gMDtcblxuICAgICAgdGhpcy5wcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9IDA7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8g0J7QsdGA0LDQsdCw0YLRi9Cy0LDQtdC8INGB0LrRgNC+0LvQuyDQstC90LjQt1xuICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PT0gJ3RvLWJvdHRvbScpIHtcblxuICAgICAgLy8g0JTQu9GPINC/0LXRgNCy0L7Qs9C+INGN0LvQtdC80LXQvdGC0LAg0L3QtSDQtNC10LvQsNC10Lwg0LDQvdC40LzQsNGG0LjQuSBcItCy0YXQvtC00LBcIlxuICAgICAgaWYgKHRoaXMuc2VjdGlvbnMuaW5kZXhPZih0aGlzLmN1cnJlbnRTZWN0aW9uKSAhPT0gMCkge1xuXG4gICAgICAgIC8vINCV0YHQu9C4INGB0LrRgNC+0LvQuyDQvNC10L3RjNGI0LUgMjUlLCDRgtC+INGD0LHQuNGA0LDQtdC8INC/0YDQvtC30YDQsNGH0L3QvtGB0YLRjCDRgyBcItGC0YPQvNCw0L3QsFwiLlxuICAgICAgICAvLyDQuCDRg9GB0YLQsNC90LDQstC70LjQstCw0LXQvCDRgdC60L7RgNC+0YHRgtGMINGC0YDQsNC90LfQuNGI0LXQvdCwLCDRh9GC0L7QsdGLINCx0YvQu9C+INC/0LvQsNCy0L3Qvi5cbiAgICAgICAgaWYgKHRoaXMuY2FsY1Njcm9sbFBlcmNlbnQoKSA8PSAyNSkge1xuICAgICAgICAgIHRoaXMuZm9nLnN0eWxlLnRyYW5zaXRpb24gPSAnb3BhY2l0eSAxcyc7XG4gICAgICAgICAgdGhpcy5mb2cuc3R5bGUub3BhY2l0eSA9IDA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8g0JXRgdC70Lgg0L3QtdGCLCDRgtC+INCy0L7Qt9Cy0YDQsNGJ0LDQtdC8INGC0YDQsNC90LfQuNGI0L0g0LIg0YHRgtCw0L3QtNCw0YDRgtC90L7QtSDQv9C+0LvQvtC20LXQvdC40LVcbiAgICAgICAgICB0aGlzLmZvZy5zdHlsZS50cmFuc2l0aW9uID0gJ29wYWNpdHkgMC4ycyc7XG4gICAgICAgIH1cbiAgICAgIH1cblxuXG4gICAgICAvLyDQlNC70Y8g0L/QvtGB0LvQtdC00L3QtdCz0L4g0Y3Qu9C10LzQtdC90YLQsCDQvdC1INC00LXQu9Cw0LXQvCDQsNC90LjQvNCw0YbQuNC5IFwi0JLRi9GF0L7QtNCwXCIuIFxuICAgICAgaWYgKHRoaXMuY3VycmVudFNlY3Rpb24gIT09IHRoaXMuc2VjdGlvbnNbdGhpcy5zZWN0aW9ucy5sZW5ndGggLSAxXSkge1xuXG4gICAgICAgIC8vICDQlNGL0Lwg0LLRi9GF0L7QtFxuICAgICAgICBpZiAodGhpcy5jYWxjU2Nyb2xsUGVyY2VudCgpID49IDU1KSB7XG4gICAgICAgICAgdGhpcy5hY3RpdmVTbW9rZTEuc3R5bGUub3BhY2l0eSA9IDE7XG4gICAgICAgIH0gXG5cbiAgICAgICAgaWYgKHRoaXMuY2FsY1Njcm9sbFBlcmNlbnQoKSA+PSA2NSkge1xuICAgICAgICAgIHRoaXMuYWN0aXZlU21va2UyLnN0eWxlLm9wYWNpdHkgPSAxO1xuICAgICAgICB9IFxuXG4gICAgICAgIGlmICh0aGlzLmNhbGNTY3JvbGxQZXJjZW50KCkgPj0gNzApIHtcbiAgICAgICAgICB0aGlzLmFjdGl2ZVNtb2tlMy5zdHlsZS5vcGFjaXR5ID0gMTtcbiAgICAgICAgfSBcblxuICAgICAgICBpZiAodGhpcy5jYWxjU2Nyb2xsUGVyY2VudCgpID49IDc1KSB7XG4gICAgICAgICAgdGhpcy5mb2cuc3R5bGUub3BhY2l0eSA9ICh0aGlzLmNhbGNTY3JvbGxQZXJjZW50KCkgLSA3NSkgKiA1ICsgJyUnO1xuICAgICAgICB9IFxuICAgICAgfVxuXG5cbiAgICAgIC8vINCU0YvQvCDQstGF0L7QtFxuICAgICAgaWYgKHRoaXMuY2FsY1Njcm9sbFBlcmNlbnQoKSA+PSA1ICYmIHRoaXMuY2FsY1Njcm9sbFBlcmNlbnQoKSA8IDQwICYmIHRoaXMuZGlyZWN0aW9uID09PSAndG8tYm90dG9tJykge1xuICAgICAgICB0aGlzLmFjdGl2ZVNtb2tlMS5zdHlsZS5vcGFjaXR5ID0gMDtcbiAgICAgIH0gXG5cbiAgICAgIGlmICh0aGlzLmNhbGNTY3JvbGxQZXJjZW50KCkgPj0gMTMgJiYgdGhpcy5jYWxjU2Nyb2xsUGVyY2VudCgpIDwgNDAgJiYgdGhpcy5kaXJlY3Rpb24gPT09ICd0by1ib3R0b20nKSB7XG4gICAgICAgIHRoaXMuYWN0aXZlU21va2UyLnN0eWxlLm9wYWNpdHkgPSAwO1xuICAgICAgfSBcblxuICAgICAgaWYgKHRoaXMuY2FsY1Njcm9sbFBlcmNlbnQoKSA+PSAxMCAmJiB0aGlzLmNhbGNTY3JvbGxQZXJjZW50KCkgPCA0MCAmJiB0aGlzLmRpcmVjdGlvbiA9PT0gJ3RvLWJvdHRvbScpIHtcbiAgICAgICAgdGhpcy5hY3RpdmVTbW9rZTMuc3R5bGUub3BhY2l0eSA9IDA7XG4gICAgICB9IFxuXG4gICAgfVxuXG5cbiAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT09ICd0by10b3AnKSB7XG4gICAgICAvLyDQlNC70Y8g0L/QtdGA0LLQvtCz0L4g0Y3Qu9C10LzQtdC90YLQsCDQvdC1INC00LXQu9Cw0LXQvCDQsNC90LjQvNCw0YbQuNC5IFwi0LLRhdC+0LTQsFwiXG4gICAgICBcbiAgICAgIGlmICh0aGlzLnNlY3Rpb25zLmluZGV4T2YodGhpcy5jdXJyZW50U2VjdGlvbikgIT09IDApIHtcblxuICAgICAgICAvLyDQlNC10LvQsNC10LwgXCLQt9Cw0YLQtdC90LXQvdC40LVcIiwg0LXRgdC70Lgg0LjQtNGR0Lwg0LLQstC10YDRhVxuICAgICAgICBpZiAodGhpcy5jYWxjU2Nyb2xsUGVyY2VudCgpIDw9IDI1KSB7XG4gICAgICAgICAgLy8gY29uc29sZS5sb2coMTI1IC0gdGhpcy5jYWxjU2Nyb2xsUGVyY2VudCgpICogNCArICclJyk7XG4gICAgICAgICAgdGhpcy5mb2cuc3R5bGUub3BhY2l0eSA9IDEyNSAtIHRoaXMuY2FsY1Njcm9sbFBlcmNlbnQoKSAqIDQgKyAnJSc7XG4gICAgICAgIH0gXG5cbiAgICAgICAgLy8g0JTRi9C8INC/0YDQuCDQv9GA0L7QutGA0YPRgtC60LUg0LLQstC10YDRhVxuICAgICAgICBpZiAodGhpcy5jYWxjU2Nyb2xsUGVyY2VudCgpIDw9IDE1KSB7XG4gICAgICAgICAgdGhpcy5hY3RpdmVTbW9rZTEuc3R5bGUub3BhY2l0eSA9IDE7XG4gICAgICAgIH0gXG5cbiAgICAgICAgaWYgKHRoaXMuY2FsY1Njcm9sbFBlcmNlbnQoKSA8PSAyMykge1xuICAgICAgICAgIHRoaXMuYWN0aXZlU21va2UyLnN0eWxlLm9wYWNpdHkgPSAxO1xuICAgICAgICB9IFxuXG4gICAgICAgIGlmICh0aGlzLmNhbGNTY3JvbGxQZXJjZW50KCkgPD0gMzUpIHtcbiAgICAgICAgICB0aGlzLmFjdGl2ZVNtb2tlMy5zdHlsZS5vcGFjaXR5ID0gMTtcbiAgICAgICAgfSBcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuY2FsY1Njcm9sbFBlcmNlbnQoKSA+PSA4NSkge1xuICAgICAgICB0aGlzLmZvZy5zdHlsZS50cmFuc2l0aW9uID0gJ29wYWNpdHkgMXMnO1xuICAgICAgICB0aGlzLmZvZy5zdHlsZS5vcGFjaXR5ID0gMDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vINCV0YHQu9C4INC90LXRgiwg0YLQviDQstC+0LfQstGA0LDRidCw0LXQvCDRgtGA0LDQvdC30LjRiNC9INCyINGB0YLQsNC90LTQsNGA0YLQvdC+0LUg0L/QvtC70L7QttC10L3QuNC1XG4gICAgICAgIHRoaXMuZm9nLnN0eWxlLnRyYW5zaXRpb24gPSAnb3BhY2l0eSAwLjJzJztcbiAgICAgIH1cblxuICAgICAgLy8g0JTRi9C8INCy0LLQtdGA0YUg0LfQsNGC0LzQtdC90LXQvdC40LUg0L/RgNC4INC/0LXRgNC10YXQvtC00LUg0YEg0L/RgNC10LTRi9C00YPRidC10LPQvlxuICAgICAgaWYgKHRoaXMuY2FsY1Njcm9sbFBlcmNlbnQoKSA8PSA5MCAmJiB0aGlzLmNhbGNTY3JvbGxQZXJjZW50KCkgPj0gNTApIHtcbiAgICAgICAgdGhpcy5hY3RpdmVTbW9rZTEuc3R5bGUub3BhY2l0eSA9IDA7XG4gICAgICB9IFxuICBcbiAgICAgIGlmICh0aGlzLmNhbGNTY3JvbGxQZXJjZW50KCkgPD0gODAgJiYgdGhpcy5jYWxjU2Nyb2xsUGVyY2VudCgpID49IDUwKSB7XG4gICAgICAgIHRoaXMuYWN0aXZlU21va2UyLnN0eWxlLm9wYWNpdHkgPSAwO1xuICAgICAgfSBcbiAgXG4gICAgICBpZiAodGhpcy5jYWxjU2Nyb2xsUGVyY2VudCgpIDw9IDc1ICYmIHRoaXMuY2FsY1Njcm9sbFBlcmNlbnQoKSA+PSA1MCkge1xuICAgICAgICB0aGlzLmFjdGl2ZVNtb2tlMy5zdHlsZS5vcGFjaXR5ID0gMDtcbiAgICAgIH0gXG4gICAgICBcbiAgICB9XG5cbiAgICAvLyDQnNC10L3Rj9C10Lwg0L7RgdC90L7QstC90L7QuSDRhtCy0LXRglxuICAgIGlmICh0aGlzLmNhbGNTY3JvbGxQZXJjZW50KCkgPj0gNDAgJiYgdGhpcy5jYWxjU2Nyb2xsUGVyY2VudCgpIDw9IDYwKSB7XG4gICAgICBpZiAodGhpcy5jdXJyZW50U2VjdGlvbi5jbGFzc0xpc3QuY29udGFpbnMoJ2Z1bGwtc2Nyb2xsX19zZXQtYmxhY2stZm9nJykpIHtcbiAgICAgICAgdGhpcy5zZXRBY3RpdmVUaGVtZSgnYmxhY2snKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc2V0QWN0aXZlVGhlbWUoJ3doaXRlJyk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgc2V0QWN0aXZlVGhlbWUodGhlbWUgPSAnd2hpdGUnKSB7XG4gICAgaWYgKHRoZW1lID09PSAnd2hpdGUnKSB7XG4gICAgICB0aGlzLmNvbG9yVGhlbWUgPSAnd2hpdGUnO1xuICAgICAgdGhpcy5mb2cuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyNmZGY1ZTYnO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNvbG9yVGhlbWUgPSAnYmxhY2snO1xuICAgICAgdGhpcy5mb2cuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyMwMzBjMWEnO1xuICAgIH1cbiAgfVxuXG4gIGV2ZW50SGVuZGxlcigpIHtcbiAgICBsZXQgb2Zmc2V0ID0gcGFnZVlPZmZzZXQ7XG4gICAgXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgKCkgPT4ge1xuICAgICAgdGhpcy5jaGFuZ2VFbGVtZW50VmlzaWJsZSgpO1xuICAgICAgdGhpcy5zZXRBYm92ZUJnT3BhY2l0eSgpO1xuICAgICAgXG4gICAgICBpZiAocGFnZVlPZmZzZXQgLSBvZmZzZXQgPCAwKSB7XG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gJ3RvLXRvcCc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9ICd0by1ib3R0b20nO1xuICAgICAgfVxuICAgICAgb2Zmc2V0ID0gcGFnZVlPZmZzZXQ7XG5cbiAgICB9KTtcbiAgfVxuXG4gIHRvU3RhbmRhcnRTY3JvbGwoKSB7XG4gICAgdGhpcy5zZWN0aW9ucy5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgaXRlbS5jbGFzc0xpc3QuYWRkKCdmdWxsLXNjcm9sbF9fZWxlbWVudC1zdGFuZGFyZC1oZWlnaHQnKTtcbiAgICB9KTtcbiAgfVxufVxuY2xhc3MgR2V0Q29vcmRzIHtcbiAgc3RhdGljIGdldENvb3JkcyhlbGVtZW50KSB7XG4gICAgY29uc3QgYm94ID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIHRvcDogYm94LnRvcCArIHBhZ2VZT2Zmc2V0LCBcbiAgICAgIGJvdHRvbTogYm94LmJvdHRvbSArIHBhZ2VZT2Zmc2V0ICBcbiAgICB9OyBcbiAgfSBcbn1cblxuY29uc3Qgc2VjdGlvblNsaWRlciA9IG5ldyBTY3JlZW5TbGlkZXIoJ2Z1bGwtc2Nyb2xsJyk7XG4vLyBjb25zdCBzZWN0aW9uU2xpZGVyMiA9IG5ldyBTY3JlZW5TbGlkZXIoJ2Z1bGwtc2Nyb2xsMicpO1xuY29uc3QgYW5jaG9yQWRkZXIgPSBuZXcgQW5jaG9yQWRkZXIoKTsiXX0=
